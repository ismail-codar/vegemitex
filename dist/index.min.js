!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.vegemite=t()}(this,function(){const e=require("klona");function t(e,n,o,r,i){var f,u=e[r++];return u?null==(f=u(o,n))?t(e,n,o,r):"function"==typeof f.then?f.then(o=>t(e,n,o,r,!0)):("object"==typeof f&&(o=f),t(e,n,o,r)):i?Promise.resolve(o):o}return function(n){var o,r={},i={},f=n||{},u=(e,t)=>{e.splice(e.indexOf(t)>>>0,1)};return o={get state(){return e(f)},on:(e,t)=>(r[e]=(r[e]||[]).concat(t),()=>u(r[e],t)),set:(n,o)=>t((i["*"]||[]).concat(o&&i[o]||[]),f,e(f=n),0),listen:(e,t)=>("function"==typeof e&&(t=e,e="*"),i[e]=(i[e]||[]).concat(t),()=>u(i[e],t)),dispatch(n,i){var u=t(r[n]||[],i,e(f),0);return"function"==typeof u.then?u.then(e=>{if(null==e)throw"state did not returned!";return o.set(e,n)}):o.set(u,n)}}}});